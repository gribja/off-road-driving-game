var R=20,R_CONTACT=1.25*R,MINIMUM_Y_VELOCITY=4,MAXIMUM_Y_VELOCITY=30,IMPACT_FRICTION=.5,G=-1,x=.25*CANVAS_WIDTH,y=.75*CANVAS_HEIGTH,vy=0,normal=new Vec2(0,1),a=new Vec2,b=new Vec2,yTouch=0,angle=0,targetAngle=0,isAlive=!1,isFlying=!0,isJumping=!0,distance=0;function initializePlayer(){y=CANVAS_HEIGTH-60,vy=0,normal.set(0,1),angle=targetAngle=0,isAlive=isFlying=isJumping=!0,distance=0}function hasCollided(a){var e=a.a,n=a.b,l=a.a2,i=a.b2;return-1!=e&&e<=y+R&&y-R<e+n||-1!=l&&l<=y+R&&y-R<l+i}function updatePlayer(){if(isAlive){y+=vy,vy+=G;var e=getColumn(x+20*scrollAccel);hasCollided(e.danger)&&(isAlive=!1,gameover());var n=(colOffset+HALF_COLUMN_WIDTH)/COLUMN_WIDTH;a.set(n*COLUMN_WIDTH,yTouch=lerp(e.height,e.next.height,easeInOutQuad(n))),y-R_CONTACT<yTouch?(b.set((n+.05)*COLUMN_WIDTH,lerp(e.height,e.next.height,easeInOutQuad(n+.05))),normal.setNormal(a,b),isJumping&&aa.play("hit"),isFlying=isJumping=!1,scrollAccel=clamp(scrollAccel+normal.x,-4,2)):isFlying=!0,yTouch<0&&(yTouch=0),y-R<yTouch&&(vy+=(yTouch+R-y)*IMPACT_FRICTION,y=yTouch+R,.5*MAXIMUM_Y_VELOCITY<vy&&(isJumping=!0,aa.play("jmp")),MAXIMUM_Y_VELOCITY<vy?vy=MAXIMUM_Y_VELOCITY:vy<0&&(vy*=-IMPACT_FRICTION)),distance+=4*T*(scrollSpeed+scrollAccel)}}function formatDistance(a){return a<1e3?Math.floor(a)+" m":(.001*a).toFixed(1)+" km"}var wn=0;function paintPlayer(a){isAlive&&(isFlying?targetAngle-=.005*Math.PI:targetAngle=Math.atan2(normal.y,normal.x)-.5*Math.PI,angle+=clamp(targetAngle-angle,.05*-Math.PI,.05*Math.PI),canvas.save(),canvas.translate(x+20*scrollAccel,y+(vy<0?vy-G:vy)*a),canvas.rotate(angle),wn=(wn+1)%4,canvas.drawImage(carSprite,-33,isFlying?-9:-12),canvas.drawImage(wheelSprites[wn],-36,-21),canvas.drawImage(wheelSprites[wn+1],9,-21),canvas.restore(),canvas.save(),canvas.scale(1,-1),canvas.fillStyle="#FFF",canvas.fillText("Distance: "+formatDistance(distance),.4*CANVAS_WIDTH,.94*-CANVAS_HEIGTH),canvas.restore())}